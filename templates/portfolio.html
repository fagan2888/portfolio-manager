<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Portfolio</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <style>
    .vcenter {
        display: inline-block;
        vertical-align: middle;
        float: none;
    }
    </style>
    <script>

        var hidden; 
        if (typeof document.hidden !== "undefined") {
            hidden = "hidden";
        } else if (typeof document.mozHidden !== "undefined") {
            hidden = "mozHidden";
        } else if (typeof document.msHidden !== "undefined") {
            hidden = "msHidden";
        } else if (typeof document.webkitHidden !== "undefined") {
            hidden = "webkitHidden";
        }    

        function refresh(){
            if(!document[hidden]){
                window.location.href = '?force_refresh=true';
            }
        }

        $(document).ready(function(e){
            setInterval(refresh, 10000);
        });
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-xs-6 vcenter">
            <h1>My Portfolio</h1>
        </div><!--
     --><div class="col-xs-6 vcenter">
            <p class="pull-right">
                <a class="btn btn-info" href="/logout">Logout</a>
            </p>
        </div>
    </div>
<div class="row">
    <div class="col-xs-6">
        <p>1 USD = {{ positions['usdcad'] }} CAD</p>
    </div>
    <div class="col-xs-6">
        <p class="pull-right">As Of {{positions['asof'] | time }}</p>
    </div>
</div>
<table class="table">
<thead>
<tr>
    <th>Category</th>
    <th class="hidden-xs">Ticker(s)</th>
    <th class="hidden-xs"><div class="pull-right">Target %</div></th>
    <th class="hidden-xs"><div class="pull-right">Current %</div></th>
    <th><div class="pull-right">Target $</div></th>
    <th><div class="pull-right">Market Value</div></th>
</tr>
</thead>
<tbody>
{% for category in positions['categories'] %}
<tr class="{{ 'danger' if category['rebalance'] else '' }}">
    <td>{{ category['name'] }}</td>
    <td class="hidden-xs">
        {% for ticker in category['tickers'] %}
            <a target="_blank" href="https://finance.yahoo.com/q?s={{ ticker }}">{{ ticker }}</a><br>
        {% endfor %}
    </td>
    <td class="hidden-xs"><div class="pull-right">{{ category['target%'] | pct }}%</div></td>
    <td class="hidden-xs"><div class="pull-right">{{ category['current%'] | pct }}%</div></td>
    <td><div class="pull-right">{{ category['target'] | money }}</div></td>
    <td><div class="pull-right">{{ category['mktvalue'] | money }}</div></td>
{% endfor %}
</tr>
</tbody>
<tfoot>
<tr>
    <td></td>
    <td class="hidden-xs"></td>
    <td class="hidden-xs"></td>
    <td class="hidden-xs"></td>
    <td><div class="pull-right">Total Market Value</div></td>
    <td><div class="pull-right">{{ positions['total'] | money }}</div></td>
</tr>
</tfoot>
</table>
</div>
</body>
</html>
